apiVersion: v1
kind: Service
metadata:
  annotations:
    traefik.enable: "true"
    traefik.http.routers.series-and-episodes-admin.entrypoints: web
    traefik.http.routers.series-and-episodes-admin.middlewares: user-service-admin
    traefik.http.routers.series-and-episodes-admin.rule: PathPrefix(`/api/admin/Series`)
      || PathPrefix(`/api/admin/Images`)
    traefik.http.routers.series-and-episodes.entrypoints: web
    traefik.http.routers.series-and-episodes.rule: PathPrefix(`/api/public/Series`)
      || PathPrefix(`/api/public/Images`)
  labels:
    io.kompose.service: series-and-episodes
  name: series-and-episodes
spec:
  ports:
  - name: "3001"
    port: 3001
    targetPort: 80
  selector:
    io.kompose.service: series-and-episodes
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    traefik.enable: "true"
    traefik.http.routers.series-and-episodes-admin.entrypoints: web
    traefik.http.routers.series-and-episodes-admin.middlewares: user-service-admin
    traefik.http.routers.series-and-episodes-admin.rule: PathPrefix(`/api/admin/Series`)
      || PathPrefix(`/api/admin/Images`)
    traefik.http.routers.series-and-episodes.entrypoints: web
    traefik.http.routers.series-and-episodes.rule: PathPrefix(`/api/public/Series`)
      || PathPrefix(`/api/public/Images`)
  labels:
    io.kompose.service: series-and-episodes
  name: series-and-episodes
spec:
  replicas: 1
  selector:
    matchLabels:
      io.kompose.service: series-and-episodes
  template:
    metadata:
      annotations:
        traefik.enable: "true"
        traefik.http.routers.series-and-episodes-admin.entrypoints: web
        traefik.http.routers.series-and-episodes-admin.middlewares: user-service-admin
        traefik.http.routers.series-and-episodes-admin.rule: PathPrefix(`/api/admin/Series`)
          || PathPrefix(`/api/admin/Images`)
        traefik.http.routers.series-and-episodes.entrypoints: web
        traefik.http.routers.series-and-episodes.rule: PathPrefix(`/api/public/Series`)
          || PathPrefix(`/api/public/Images`)
      labels:
        io.kompose.service: series-and-episodes
    spec:
      containers:
      - env:
        - name: MessageQueueSettings__Hostname
          value: message-queue
        - name: MessageQueueSettings__Password
          value: guest
        - name: MessageQueueSettings__Username
          value: guest
        - name: SeriesDbSettings__ConnectionString
          value: mongodb://root:rootpassword@mongodb-seriesdb:27017
        - name: SeriesDbSettings__DatabaseName
          value: SeriesDb
        - name: SeriesDbSettings__SeriesCollectionName
          value: Series
        - name: TokenSettings__Audience
          value: http://localhost:80
        - name: TokenSettings__Issuer
          value: http://localhost:80
        - name: TokenSettings__Secret
          value: A_long_enough_secret_text_which_is_not_too_short_unless_there_will_be_an_error
        image: series-and-episodes:dev
        name: series-and-episodes
        ports:
        - containerPort: 80
      restartPolicy: Always
